<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrevista - Plataforma PIENSA</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .prep-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: var(--radius-sm);
            border: 1px solid #E5E7EB;
            cursor: pointer;
        }

        .checklist-item input {
            margin-right: 1rem;
            transform: scale(1.2);
        }

        .question-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-md);
            border: 1px solid #E5E7EB;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .question-card:hover {
            border-color: var(--primary-color);
        }

        .question-header {
            font-weight: 600;
            display: flex;
            justify-content: space-between;
        }

        .answer-tip {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed #E5E7EB;
            color: var(--text-muted);
            display: none;
        }

        .question-card.active .answer-tip {
            display: block;
        }

        .toggle-icon {
            font-weight: bold;
            color: var(--primary-color);
        }
    </style>
</head>

<body style="background: #F9FAFB;">

    <nav class="navbar">
        <div class="container nav-container">
            <a href="menu.html" class="logo">PIENSA</a>
            <div class="nav-links">
                <a href="menu.html">Volver al Panel</a>
            </div>
        </div>
    </nav>

    <header style="background: white; padding: 2rem 0; border-bottom: 1px solid #E5E7EB; margin-bottom: 2rem;">
        <div class="container">
            <h1>Simulador y Tips de Entrevista</h1>
            <p style="color: var(--text-muted);">Prep√°rate para destacar en tu pr√≥xima reuni√≥n.</p>
        </div>
    </header>

    <main class="container">

        <!-- Tips Section (Full Width) -->
        <section style="margin-bottom: 3rem;">
            <h2 style="margin-bottom: 1.5rem;">Consejos antes de la entrevista</h2>
            <div class="checklist"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                <div class="tip-card">
                    <span class="emoji-icon">üè¢</span> Investigar sobre la empresa y su cultura.
                </div>
                <div class="tip-card">
                    <span class="emoji-icon">üìù</span> Revisar la descripci√≥n del puesto.
                </div>
                <div class="tip-card">
                    <span class="emoji-icon">üëî</span> Preparar tu vestimenta (formal/casual).
                </div>
                <div class="tip-card">
                    <span class="emoji-icon">üìπ</span> Verificar conexi√≥n y c√°mara (si es virtual).
                </div>
                <div class="tip-card">
                    <span class="emoji-icon">üìÑ</span> Tener copia de tu CV a la mano.
                </div>
                <div class="tip-card">
                    <span class="emoji-icon">‚ùì</span> Preparar preguntas para el entrevistador.
                </div>
            </div>
        </section>

        <!-- Questions Simulator (Per-Question Row Layout) -->
        <section>
            <h2 style="margin-bottom: 2rem;">Simulador de Entrevista</h2>

            <!-- Question 1 -->
            <article class="interview-row">
                <div class="interview-question-col">
                    <div class="question-card" onclick="this.classList.toggle('active')" style="margin-bottom: 0;">
                        <div class="question-header">
                            ¬øCu√©ntame sobre ti?
                            <span class="toggle-icon">+</span>
                        </div>
                        <div class="answer-tip" style="display: block;">
                            <strong>Tip:</strong> No recites tu CV. Habla de tu pasi√≥n por el √°rea, una experiencia
                            clave reciente y por qu√© te interesa este rol. Mant√©nlo bajo 2 minutos.
                        </div>
                    </div>
                </div>
                <div class="interview-practice-col">
                    <textarea class="compact-textarea" placeholder="Escribe tu respuesta aqu√≠..."></textarea>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.8rem; color: var(--text-muted);">IA lista para analizar</span>
                        <button class="btn btn-primary" style="font-size: 0.85rem; padding: 0.4rem 1rem;"
                            onclick="simulateAIAnalysis(this)">Analizar Respuesta</button>
                    </div>
                    <div class="ai-feedback-placeholder">
                        <span>üß† Aqu√≠ aparecer√° tu retroalimentaci√≥n.</span>
                    </div>
                </div>
            </article>

            <!-- Question 2 -->
            <article class="interview-row">
                <div class="interview-question-col">
                    <div class="question-card" onclick="this.classList.toggle('active')" style="margin-bottom: 0;">
                        <div class="question-header">
                            ¬øCu√°l es tu mayor debilidad?
                            <span class="toggle-icon">+</span>
                        </div>
                        <div class="answer-tip">
                            <strong>Tip:</strong> Elige una debilidad real pero no cr√≠tica. Enf√≥cate en c√≥mo est√°s
                            trabajando para mejorarla.
                        </div>
                    </div>
                </div>
                <div class="interview-practice-col">
                    <textarea class="compact-textarea" placeholder="Escribe tu respuesta aqu√≠..."></textarea>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.8rem; color: var(--text-muted);">IA lista para analizar</span>
                        <button class="btn btn-primary" style="font-size: 0.85rem; padding: 0.4rem 1rem;"
                            onclick="simulateAIAnalysis(this)">Analizar Respuesta</button>
                    </div>
                    <div class="ai-feedback-placeholder">
                        <span>üß† Aqu√≠ aparecer√° tu retroalimentaci√≥n.</span>
                    </div>
                </div>
            </article>

            <!-- Question 3 -->
            <article class="interview-row">
                <div class="interview-question-col">
                    <div class="question-card" onclick="this.classList.toggle('active')" style="margin-bottom: 0;">
                        <div class="question-header">
                            ¬øD√≥nde te ves en 5 a√±os?
                            <span class="toggle-icon">+</span>
                        </div>
                        <div class="answer-tip">
                            <strong>Tip:</strong> Muestra ambici√≥n pero alineada con la empresa. "Espero haber crecido
                            en roles de liderazgo..."
                        </div>
                    </div>
                </div>
                <div class="interview-practice-col">
                    <textarea class="compact-textarea" placeholder="Escribe tu respuesta aqu√≠..."></textarea>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.8rem; color: var(--text-muted);">IA lista para analizar</span>
                        <button class="btn btn-primary" style="font-size: 0.85rem; padding: 0.4rem 1rem;"
                            onclick="simulateAIAnalysis(this)">Analizar Respuesta</button>
                    </div>
                    <div class="ai-feedback-placeholder">
                        <span>üß† Aqu√≠ aparecer√° tu retroalimentaci√≥n.</span>
                    </div>
                </div>
            </article>

            <!-- Question 4 -->
            <article class="interview-row">
                <div class="interview-question-col">
                    <div class="question-card" onclick="this.classList.toggle('active')" style="margin-bottom: 0;">
                        <div class="question-header">
                            ¬øPor qu√© deber√≠amos contratarte?
                            <span class="toggle-icon">+</span>
                        </div>
                        <div class="answer-tip">
                            <strong>Tip:</strong> Conecta tus habilidades blandas (soft skills) con las necesidades de
                            la empresa.
                        </div>
                    </div>
                </div>
                <div class="interview-practice-col">
                    <textarea class="compact-textarea" placeholder="Escribe tu respuesta aqu√≠..."></textarea>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.8rem; color: var(--text-muted);">IA lista para analizar</span>
                        <button class="btn btn-primary" style="font-size: 0.85rem; padding: 0.4rem 1rem;"
                            onclick="alert('An√°lisis de IA simulado...')">Analizar Respuesta</button>
                    </div>
                    <div class="ai-feedback-placeholder">
                        <span>üß† Aqu√≠ aparecer√° tu retroalimentaci√≥n.</span>
                    </div>
                </div>
            </article>

            <section style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="finishPractice(this)">‚úÖ Registrar Pr√°ctica</button>
            </section>
        </section>
    </main>
    <script src="js/app.js"></script>
    <script type="module">
        import { db } from './js/firebase-init.js';
        import { doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // AI Feedback Simulation
        window.simulateAIAnalysis = function (btn) {
            // Find the feedback container in the same column
            const container = btn.closest('.interview-practice-col');
            const feedbackBox = container.querySelector('.ai-feedback-placeholder');
            const originalText = btn.innerHTML;

            // Loading State
            btn.disabled = true;
            btn.innerHTML = 'Analizando... <span style="animation: pulse 1s infinite">üß†</span>';
            feedbackBox.innerHTML = '<span style="color:var(--primary-color); animation: pulse 0.8s infinite">Generando retroalimentaci√≥n inteligente...</span>';

            setTimeout(() => {
                // Success State
                btn.innerHTML = '¬°Analizado! ‚úì';
                btn.style.backgroundColor = "#10B981"; // Success green
                btn.style.borderColor = "#10B981";

                feedbackBox.innerHTML = `
                    <div style="display:flex; flex-direction:column; gap:0.5rem;">
                        <strong style="color: #15803d;">‚úÖ An√°lisis Completado:</strong>
                        <p style="font-size: 0.9rem; color: #166534;">
                            Tu respuesta tiene una buena estructura. Has mencionado palabras clave importantes alineadas con el perfil. 
                            <strong>Recomendaci√≥n:</strong> Intenta incluir un ejemplo cuantitativo para dar m√°s impacto.
                        </p>
                    </div>
                `;
                feedbackBox.classList.add('success');

                // Reset button state after 3 seconds (optional, but good UX to allow re-analysis)
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    btn.style.backgroundColor = "";
                    btn.style.borderColor = "";
                }, 4000);

            }, 2000); // 2 seconds simulation
        }

        window.finishPractice = async function (btnElement) {
            // Find button if not passed directly (fallback)
            const btn = btnElement || document.querySelector('button[onclick="finishPractice()"]');

            const originalText = btn ? btn.innerHTML : 'Registrar Pr√°ctica';

            const userJson = localStorage.getItem('piensaUser');
            if (!userJson) {
                if (btn) {
                    btn.innerHTML = '‚ö†Ô∏è Inicia sesi√≥n primero';
                    btn.style.backgroundColor = '#f59e0b'; // Amber warning
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.style.backgroundColor = '';
                    }, 3000);
                }
                return;
            }
            const user = JSON.parse(userJson);

            // Initialize flags
            if (!user.progressSteps) user.progressSteps = { cv: false, interview: false, job: false };

            // Loading state
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = 'Guardando...';
            }

            try {
                const userRef = doc(db, "users", user.uid);
                let updates = {
                    entrevistas: increment(1)
                };

                // Check Progress Goal
                if (!user.progressSteps.interview) {
                    const currentProgress = user.perfilCompletado || 10;
                    const newProgress = Math.min(currentProgress + 25, 100);

                    updates.perfilCompletado = newProgress;
                    updates["progressSteps.interview"] = true;

                    user.perfilCompletado = newProgress;
                    user.progressSteps.interview = true;
                }

                await updateDoc(userRef, updates);

                // Update local storage
                user.entrevistas = (user.entrevistas || 0) + 1;
                localStorage.setItem('piensaUser', JSON.stringify(user));

                // Success UI
                if (btn) {
                    btn.innerHTML = '¬°Guardado! ‚úÖ';
                    btn.style.backgroundColor = '#10B981'; // Green
                    btn.style.borderColor = '#10B981';

                    setTimeout(() => {
                        window.location.href = 'menu.html';
                    }, 1500);
                } else {
                    window.location.href = 'menu.html';
                }

            } catch (error) {
                console.error("Error:", error);
                if (btn) {
                    btn.innerHTML = '‚ùå Error al guardar';
                    btn.style.backgroundColor = '#ef4444'; // Red
                    btn.disabled = false;
                }
            }
        }
    </script>
</body>

</html>